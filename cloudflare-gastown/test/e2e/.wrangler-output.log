[33mâ–² [43;33m[[43;30mWARNING[43;33m][0m [1mUnrecognised WRANGLER_LOG value "/users/john/projects/professional/kilo/cloud/cloudflare-gastown/test/e2e/.wrangler-output.log", expected "none" | "error" | "warn" | "info" | "log" | "debug", defaulting to "log"...[0m



 â›…ï¸ wrangler 4.61.1 (update available 4.67.0)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Your Worker has access to the following bindings:
Binding                                                                                Resource                  Mode
env.GASTOWN_USER (GastownUserDO)                                                       Durable Object            local
env.AGENT_IDENTITY (AgentIdentityDO)                                                   Durable Object            local
env.TOWN (TownDO)                                                                      Durable Object            local
env.TOWN_CONTAINER (TownContainerDO)                                                   Durable Object            local
env.AGENT (AgentDO)                                                                    Durable Object            local
env.GASTOWN_JWT_SECRET (342a86d9e3a94da698e82d0c6e2a36f0/GASTOWN_JWT_SECRET_PROD)      Secrets Store Secret      local
env.ENVIRONMENT ("development")                                                        Environment Variable      local
env.CF_ACCESS_TEAM ("engineering-e11")                                                 Environment Variable      local
env.CF_ACCESS_AUD ("f30e3fd893df52fa3ffc50fbdb5ee6a4f1116...")                         Environment Variable      local
env.KILO_API_URL ("http://host.docker.internal:3000")                                  Environment Variable      local
env.GASTOWN_API_URL ("(hidden)")                                                       Environment Variable      local

The following containers are available:
- gastown-dev-TownContainerDO (/Users/john/projects/professional/kilo/cloud/cloudflare-gastown/container/Dockerfile.dev)

âŽ” Preparing container image(s)...
#0 building with "desktop-linux" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 2.49kB done
#1 WARN: FromPlatformFlagConstDisallowed: FROM --platform flag should not use constant value "linux/arm64" (line 1)
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/oven/bun:1-slim
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 758B done
#4 DONE 0.0s

#5 [ 1/10] FROM docker.io/oven/bun:1-slim@sha256:8ca06c7812d9050ccc4b80799685f395d6a0d051d3b7207dfd120e2b437b1ec9
#5 resolve docker.io/oven/bun:1-slim@sha256:8ca06c7812d9050ccc4b80799685f395d6a0d051d3b7207dfd120e2b437b1ec9 done
#5 DONE 0.0s

#6 [ 4/10] RUN mkdir -p /workspace/rigs /app
#6 CACHED

#7 [ 8/10] COPY package.json bun.lock ./
#7 CACHED

#8 [ 2/10] RUN apt-get update &&     apt-get install -y --no-install-recommends git curl ca-certificates &&     curl -fsSL https://deb.nodesource.com/setup_22.x | bash - &&     apt-get install -y --no-install-recommends nodejs &&     curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg       -o /usr/share/keyrings/githubcli-archive-keyring.gpg &&     echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"       > /etc/apt/sources.list.d/github-cli.list &&     apt-get update &&     apt-get install -y --no-install-recommends gh &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
#8 CACHED

#9 [ 6/10] RUN cd /opt/gastown-plugin && npm install --omit=dev &&     mkdir -p /root/.config/kilo/plugins &&     ln -s /opt/gastown-plugin/index.ts /root/.config/kilo/plugins/gastown.ts
#9 CACHED

#10 [ 7/10] WORKDIR /app
#10 CACHED

#11 [ 3/10] RUN npm install -g @kilocode/cli @kilocode/cli-linux-arm64 @kilocode/cli-linux-arm64-musl &&     ln -s "$(which kilo)" /usr/local/bin/opencode
#11 CACHED

#12 [ 5/10] COPY plugin/ /opt/gastown-plugin/
#12 CACHED

#13 [ 9/10] RUN bun install --frozen-lockfile --production
#13 CACHED

#14 [10/10] COPY src/ ./src/
#14 CACHED

#15 exporting to image
#15 exporting layers done
#15 exporting manifest sha256:11c86f9000477e76dc399ac628c0bc0e175d2942fe571c3187e4f40fd36c96d2 done
#15 exporting config sha256:7f9a17878393871fd19c7c23cc4178ab5f61edc40dcd90b1504590d194cacdca done
#15 naming to docker.io/cloudflare-dev/towncontainerdo:8306994c done
#15 DONE 0.0s

 [33m1 warning found (use docker --debug to expand):
[0m - FromPlatformFlagConstDisallowed: FROM --platform flag should not use constant value "linux/arm64" (line 1)
âŽ” Container image(s) ready
âŽ” Starting local server...
[wrangler:info] Ready on http://localhost:9787
[gastown-worker] --> GET /health
[gastown-worker] <-- GET /health 200 (0ms)
[wrangler:info] GET /health 200 OK (1129ms)
[gastown-worker] --> POST /api/users/e2e-user-1771633380-12404/towns
[GastownUser.do] createTown: id=db2477fa-05e6-42d0-b797-b3a47a11d4e5 name=WS-Events-Town owner=e2e-user-1771633380-12404
[GastownUser.do] createTown: created town id=db2477fa-05e6-42d0-b797-b3a47a11d4e5
[gastown-worker] <-- POST /api/users/e2e-user-1771633380-12404/towns 201 (10ms)
[wrangler:info] POST /api/users/e2e-user-1771633380-12404/towns 201 Created (11ms)
[gastown-worker] --> POST /api/users/e2e-user-1771633380-12404/rigs
[towns.handler] handleCreateRig: userId=e2e-user-1771633380-12404 town_id=db2477fa-05e6-42d0-b797-b3a47a11d4e5 name=ws-rig git_url=https://github.com/test/repo.git
[GastownUser.do] createRig: town_id=db2477fa-05e6-42d0-b797-b3a47a11d4e5 name=ws-rig git_url=https://github.com/test/repo.git default_branch=main integration=none
[GastownUser.do] createRig: created rig id=420755aa-7e1b-4ed3-8431-aec42837e823
[towns.handler] handleCreateRig: rig created id=420755aa-7e1b-4ed3-8431-aec42837e823, now configuring Rig DO
[Town.do] configureRig: rigId=420755aa-7e1b-4ed3-8431-aec42837e823 hasKilocodeToken=true
[Town.do] configureRig: propagating kilocodeToken to town config
[Town.do] updateTownConfig: saved config with 0 env vars
[towns.handler] handleCreateRig: Town DO configured and rig registered
[gastown-worker] <-- POST /api/users/e2e-user-1771633380-12404/rigs 201 (5ms)
[wrangler:info] POST /api/users/e2e-user-1771633380-12404/rigs 201 Created (5ms)
[gastown-worker] --> POST /api/towns/db2477fa-05e6-42d0-b797-b3a47a11d4e5/mayor/message
[mayor.handler] handleSendMayorMessage: townId=db2477fa-05e6-42d0-b797-b3a47a11d4e5 message="Say hello world in one sentence"
Error checking if container is ready: connect(): Connection refused: container port not found. Make sure you exposed the port in your container definition.
Port 8080 is ready
[TownContainer.do] container started for DO id=9f80e66f1acfacea057df7cd8160f25d2f65210261cb2e35587306bdb626fa47
[Town.do] startAgentInContainer: agentId=6bda5846-3a78-4b46-a0d8-b4bcf375fccd role=mayor name=mayor
[31mâœ˜ [41;31m[[41;97mERROR[41;31m][0m [1mFailed to resolve GASTOWN_JWT_SECRET[0m


[gastown-worker] <-- POST /api/towns/db2477fa-05e6-42d0-b797-b3a47a11d4e5/mayor/message 200 (6362ms)
[wrangler:info] POST /api/towns/db2477fa-05e6-42d0-b797-b3a47a11d4e5/mayor/message 200 OK (6363ms)
[Town.do] alarm: fired for town=db2477fa-05e6-42d0-b797-b3a47a11d4e5
[gastown-worker] WS upgrade: townId=db2477fa-05e6-42d0-b797-b3a47a11d4e5 agentId=6bda5846-3a78-4b46-a0d8-b4bcf375fccd
[TownContainer.do] WS connected: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd
[TownContainer.do] Started event polling via alarm (500ms)
[wrangler:info] GET /api/towns/db2477fa-05e6-42d0-b797-b3a47a11d4e5/container/agents/6bda5846-3a78-4b46-a0d8-b4bcf375fccd/stream 101 Switching Protocols (5ms)
[TownContainer.do] WS client subscribed to agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd
[TownContainer.do] poll: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd after=18 events=0
[TownContainer.do] poll: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd after=18 events=0
[TownContainer.do] poll: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd after=18 events=0
[TownContainer.do] poll: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd after=18 events=0
[TownContainer.do] poll: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd after=18 events=0
[TownContainer.do] poll: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd after=18 events=1
[Town.do] alarm: fired for town=db2477fa-05e6-42d0-b797-b3a47a11d4e5
[TownContainer.do] WS closed: agent=6bda5846-3a78-4b46-a0d8-b4bcf375fccd code=1005
[TownContainer.do] Stopped event polling
ðŸªµ  Logs were written to "/Users/john/Library/Preferences/.wrangler/logs/wrangler-2026-02-21_00-22-58_434.log"
