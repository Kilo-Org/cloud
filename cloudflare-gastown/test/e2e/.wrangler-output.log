[33mâ–² [43;33m[[43;30mWARNING[43;33m][0m [1mUnrecognised WRANGLER_LOG value "/users/john/projects/professional/kilo/cloud/cloudflare-gastown/test/e2e/.wrangler-output.log", expected "none" | "error" | "warn" | "info" | "log" | "debug", defaulting to "log"...[0m



 â›…ï¸ wrangler 4.61.1 (update available 4.67.0)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Your Worker has access to the following bindings:
Binding                                                                                Resource                  Mode
env.GASTOWN_USER (GastownUserDO)                                                       Durable Object            local
env.AGENT_IDENTITY (AgentIdentityDO)                                                   Durable Object            local
env.TOWN (TownDO)                                                                      Durable Object            local
env.TOWN_CONTAINER (TownContainerDO)                                                   Durable Object            local
env.AGENT (AgentDO)                                                                    Durable Object            local
env.GASTOWN_JWT_SECRET (342a86d9e3a94da698e82d0c6e2a36f0/GASTOWN_JWT_SECRET_PROD)      Secrets Store Secret      local
env.ENVIRONMENT ("development")                                                        Environment Variable      local
env.CF_ACCESS_TEAM ("engineering-e11")                                                 Environment Variable      local
env.CF_ACCESS_AUD ("f30e3fd893df52fa3ffc50fbdb5ee6a4f1116...")                         Environment Variable      local
env.KILO_API_URL ("http://host.docker.internal:3000")                                  Environment Variable      local
env.GASTOWN_API_URL ("(hidden)")                                                       Environment Variable      local

The following containers are available:
- gastown-dev-TownContainerDO (/Users/john/projects/professional/kilo/cloud/cloudflare-gastown/container/Dockerfile.dev)

âŽ” Preparing container image(s)...
#0 building with "desktop-linux" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 2.49kB done
#1 WARN: FromPlatformFlagConstDisallowed: FROM --platform flag should not use constant value "linux/arm64" (line 1)
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/oven/bun:1-slim
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 758B done
#4 DONE 0.0s

#5 [ 1/10] FROM docker.io/oven/bun:1-slim@sha256:8ca06c7812d9050ccc4b80799685f395d6a0d051d3b7207dfd120e2b437b1ec9
#5 resolve docker.io/oven/bun:1-slim@sha256:8ca06c7812d9050ccc4b80799685f395d6a0d051d3b7207dfd120e2b437b1ec9 done
#5 DONE 0.0s

#6 [ 4/10] RUN mkdir -p /workspace/rigs /app
#6 CACHED

#7 [ 2/10] RUN apt-get update &&     apt-get install -y --no-install-recommends git curl ca-certificates &&     curl -fsSL https://deb.nodesource.com/setup_22.x | bash - &&     apt-get install -y --no-install-recommends nodejs &&     curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg       -o /usr/share/keyrings/githubcli-archive-keyring.gpg &&     echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"       > /etc/apt/sources.list.d/github-cli.list &&     apt-get update &&     apt-get install -y --no-install-recommends gh &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
#7 CACHED

#8 [ 3/10] RUN npm install -g @kilocode/cli @kilocode/cli-linux-arm64 @kilocode/cli-linux-arm64-musl &&     ln -s "$(which kilo)" /usr/local/bin/opencode
#8 CACHED

#9 [ 6/10] RUN cd /opt/gastown-plugin && npm install --omit=dev &&     mkdir -p /root/.config/kilo/plugins &&     ln -s /opt/gastown-plugin/index.ts /root/.config/kilo/plugins/gastown.ts
#9 CACHED

#10 [ 8/10] COPY package.json bun.lock ./
#10 CACHED

#11 [ 9/10] RUN bun install --frozen-lockfile --production
#11 CACHED

#12 [ 5/10] COPY plugin/ /opt/gastown-plugin/
#12 CACHED

#13 [ 7/10] WORKDIR /app
#13 CACHED

#14 [10/10] COPY src/ ./src/
#14 CACHED

#15 exporting to image
#15 exporting layers done
#15 exporting manifest sha256:2e4b4232f8b8b952ae047ce81b26fd1fc36ca2ec139f201bc9f6247454899919 done
#15 exporting config sha256:dbb3ee65a53d50582c7adc493f087b72101ad6032081400409ee3e1f0b5d3fed done
#15 naming to docker.io/cloudflare-dev/towncontainerdo:cca6dcd8 done
#15 DONE 0.0s

 [33m1 warning found (use docker --debug to expand):
[0m - FromPlatformFlagConstDisallowed: FROM --platform flag should not use constant value "linux/arm64" (line 1)
âŽ” Container image(s) ready
âŽ” Starting local server...
[wrangler:info] Ready on http://localhost:9787
[gastown-worker] --> GET /health
[gastown-worker] <-- GET /health 200 (0ms)
[wrangler:info] GET /health 200 OK (945ms)
[gastown-worker] --> POST /api/users/e2e-user-1771634486-17222/towns
[GastownUser.do] createTown: id=a9a59872-61d8-4431-b2de-3db2558e92d6 name=NextJS-Token-Town owner=e2e-user-1771634486-17222
[GastownUser.do] createTown: created town id=a9a59872-61d8-4431-b2de-3db2558e92d6
[gastown-worker] <-- POST /api/users/e2e-user-1771634486-17222/towns 201 (3ms)
[wrangler:info] POST /api/users/e2e-user-1771634486-17222/towns 201 Created (4ms)
[gastown-worker] --> POST /api/users/e2e-user-1771634486-17222/rigs
[towns.handler] handleCreateRig: userId=e2e-user-1771634486-17222 town_id=a9a59872-61d8-4431-b2de-3db2558e92d6 name=nextjs-rig git_url=https://github.com/test/repo.git
[GastownUser.do] createRig: town_id=a9a59872-61d8-4431-b2de-3db2558e92d6 name=nextjs-rig git_url=https://github.com/test/repo.git default_branch=main integration=none
[GastownUser.do] createRig: created rig id=efd32a83-66af-484f-af8a-bc281a8aea45
[towns.handler] handleCreateRig: rig created id=efd32a83-66af-484f-af8a-bc281a8aea45, now configuring Rig DO
[Town.do] configureRig: rigId=efd32a83-66af-484f-af8a-bc281a8aea45 hasKilocodeToken=true
[Town.do] configureRig: propagating kilocodeToken to town config
[Town.do] updateTownConfig: saved config with 0 env vars
[Town.do] configureRig: proactively starting container
Error checking if container is ready: connect(): Connection refused: container port not found. Make sure you exposed the port in your container definition.
Port 8080 is ready
[TownContainer.do] container started for DO id=338b21266edaae01c2a8ad569f4204f1e1480f8a5e5433cdce2cbbe2da012131
[towns.handler] handleCreateRig: Town DO configured and rig registered
[gastown-worker] <-- POST /api/users/e2e-user-1771634486-17222/rigs 201 (323ms)
[wrangler:info] POST /api/users/e2e-user-1771634486-17222/rigs 201 Created (324ms)
[gastown-worker] --> GET /api/towns/a9a59872-61d8-4431-b2de-3db2558e92d6/config
[gastown-worker] <-- GET /api/towns/a9a59872-61d8-4431-b2de-3db2558e92d6/config 200 (0ms)
[wrangler:info] GET /api/towns/a9a59872-61d8-4431-b2de-3db2558e92d6/config 200 OK (1ms)
[gastown-worker] --> GET /health
[gastown-worker] <-- GET /health 200 (0ms)
[wrangler:info] GET /health 200 OK (1ms)
