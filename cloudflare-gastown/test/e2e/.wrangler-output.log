[33mâ–² [43;33m[[43;30mWARNING[43;33m][0m [1mUnrecognised WRANGLER_LOG value "/users/john/projects/professional/kilo/cloud/cloudflare-gastown/test/e2e/.wrangler-output.log", expected "none" | "error" | "warn" | "info" | "log" | "debug", defaulting to "log"...[0m



 â›…ï¸ wrangler 4.61.1 (update available 4.67.0)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Your Worker has access to the following bindings:
Binding                                                                                Resource                  Mode
env.GASTOWN_USER (GastownUserDO)                                                       Durable Object            local
env.AGENT_IDENTITY (AgentIdentityDO)                                                   Durable Object            local
env.TOWN (TownDO)                                                                      Durable Object            local
env.TOWN_CONTAINER (TownContainerDO)                                                   Durable Object            local
env.AGENT (AgentDO)                                                                    Durable Object            local
env.GASTOWN_JWT_SECRET (342a86d9e3a94da698e82d0c6e2a36f0/GASTOWN_JWT_SECRET_PROD)      Secrets Store Secret      local
env.ENVIRONMENT ("development")                                                        Environment Variable      local
env.CF_ACCESS_TEAM ("engineering-e11")                                                 Environment Variable      local
env.CF_ACCESS_AUD ("f30e3fd893df52fa3ffc50fbdb5ee6a4f1116...")                         Environment Variable      local
env.KILO_API_URL ("http://host.docker.internal:3000")                                  Environment Variable      local
env.GASTOWN_API_URL ("(hidden)")                                                       Environment Variable      local

The following containers are available:
- gastown-dev-TownContainerDO (/Users/john/projects/professional/kilo/cloud/cloudflare-gastown/container/Dockerfile.dev)

âŽ” Preparing container image(s)...
#0 building with "desktop-linux" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 2.49kB done
#1 WARN: FromPlatformFlagConstDisallowed: FROM --platform flag should not use constant value "linux/arm64" (line 1)
#1 DONE 0.0s

#2 [auth] oven/bun:pull token for registry-1.docker.io
#2 DONE 0.0s

#3 [internal] load metadata for docker.io/oven/bun:1-slim
#3 DONE 0.5s

#4 [internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 758B done
#5 DONE 0.0s

#6 [ 1/10] FROM docker.io/oven/bun:1-slim@sha256:8ca06c7812d9050ccc4b80799685f395d6a0d051d3b7207dfd120e2b437b1ec9
#6 resolve docker.io/oven/bun:1-slim@sha256:8ca06c7812d9050ccc4b80799685f395d6a0d051d3b7207dfd120e2b437b1ec9 done
#6 DONE 0.0s

#7 [ 6/10] RUN cd /opt/gastown-plugin && npm install --omit=dev &&     mkdir -p /root/.config/kilo/plugins &&     ln -s /opt/gastown-plugin/index.ts /root/.config/kilo/plugins/gastown.ts
#7 CACHED

#8 [ 9/10] RUN bun install --frozen-lockfile --production
#8 CACHED

#9 [ 8/10] COPY package.json bun.lock ./
#9 CACHED

#10 [ 4/10] RUN mkdir -p /workspace/rigs /app
#10 CACHED

#11 [ 2/10] RUN apt-get update &&     apt-get install -y --no-install-recommends git curl ca-certificates &&     curl -fsSL https://deb.nodesource.com/setup_22.x | bash - &&     apt-get install -y --no-install-recommends nodejs &&     curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg       -o /usr/share/keyrings/githubcli-archive-keyring.gpg &&     echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"       > /etc/apt/sources.list.d/github-cli.list &&     apt-get update &&     apt-get install -y --no-install-recommends gh &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
#11 CACHED

#12 [ 5/10] COPY plugin/ /opt/gastown-plugin/
#12 CACHED

#13 [ 7/10] WORKDIR /app
#13 CACHED

#14 [ 3/10] RUN npm install -g @kilocode/cli @kilocode/cli-linux-arm64 @kilocode/cli-linux-arm64-musl &&     ln -s "$(which kilo)" /usr/local/bin/opencode
#14 CACHED

#15 [10/10] COPY src/ ./src/
#15 CACHED

#16 exporting to image
#16 exporting layers done
#16 exporting manifest sha256:4f9b77ca597fa6c3b4c98a50d50afe71f7151899c0a2cc271d22e958a278d641 done
#16 exporting config sha256:c0900d5272db6e67fa47b37bfb056eb961e2bf557cc6355cc876ed6536479801 done
#16 naming to docker.io/cloudflare-dev/towncontainerdo:6ef23677 done
#16 DONE 0.0s

 [33m1 warning found (use docker --debug to expand):
[0m - FromPlatformFlagConstDisallowed: FROM --platform flag should not use constant value "linux/arm64" (line 1)
âŽ” Container image(s) ready
âŽ” Starting local server...
[wrangler:info] Ready on http://localhost:9787
[gastown-worker] --> GET /health
[gastown-worker] <-- GET /health 200 (0ms)
[wrangler:info] GET /health 200 OK (1433ms)
[gastown-worker] --> POST /api/users/e2e-user-1771641605-30392/towns
[GastownUser.do] createTown: id=235a017c-0f9c-4174-95f4-a360b4d0c97f name=Token-Trace-Town owner=e2e-user-1771641605-30392
[GastownUser.do] createTown: created town id=235a017c-0f9c-4174-95f4-a360b4d0c97f
[gastown-worker] <-- POST /api/users/e2e-user-1771641605-30392/towns 201 (3ms)
[wrangler:info] POST /api/users/e2e-user-1771641605-30392/towns 201 Created (4ms)
[gastown-worker] --> GET /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/config
[gastown-worker] <-- GET /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/config 200 (5ms)
[wrangler:info] GET /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/config 200 OK (5ms)
[gastown-worker] --> POST /api/users/e2e-user-1771641605-30392/rigs
[towns.handler] handleCreateRig: userId=e2e-user-1771641605-30392 town_id=235a017c-0f9c-4174-95f4-a360b4d0c97f name=trace-rig git_url=https://github.com/test/repo.git hasKilocodeToken=true
[GastownUser.do] createRig: town_id=235a017c-0f9c-4174-95f4-a360b4d0c97f name=trace-rig git_url=https://github.com/test/repo.git default_branch=main integration=none
[GastownUser.do] createRig: created rig id=c352a363-ca85-4cb5-9699-4764cf41726e
[towns.handler] handleCreateRig: rig created id=c352a363-ca85-4cb5-9699-4764cf41726e, now configuring Rig DO
[Town.do] configureRig: rigId=c352a363-ca85-4cb5-9699-4764cf41726e hasKilocodeToken=true
[Town.do] configureRig: propagating kilocodeToken to town config
[Town.do] updateTownConfig: saved config with 0 env vars
[TownContainer.do] setEnvVar: KILOCODE_TOKEN=e2e-trac... stored
[Town.do] configureRig: stored KILOCODE_TOKEN on TownContainerDO
[Town.do] configureRig: proactively starting container
Error checking if container is ready: connect(): Connection refused: container port not found. Make sure you exposed the port in your container definition.
Port 8080 is ready
[TownContainer.do] container started for DO id=3a69d3ecf2f03c67197ce05dd3277a7574401f16e80739369d31e359745d3794
[towns.handler] handleCreateRig: Town DO configured and rig registered
[gastown-worker] <-- POST /api/users/e2e-user-1771641605-30392/rigs 201 (329ms)
[wrangler:info] POST /api/users/e2e-user-1771641605-30392/rigs 201 Created (331ms)
[gastown-worker] --> GET /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/config
[gastown-worker] <-- GET /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/config 200 (0ms)
[wrangler:info] GET /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/config 200 OK (2ms)
[gastown-worker] --> POST /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/mayor/message
[mayor.handler] handleSendMayorMessage: townId=235a017c-0f9c-4174-95f4-a360b4d0c97f message="Token trace test"
[TownContainer.do] setEnvVar: KILOCODE_TOKEN=e2e-trac... stored
[Town.do] startAgentInContainer: agentId=1bd33ec7-81ec-41e6-ad47-98e63bf2a4fd role=mayor name=mayor
[31mâœ˜ [41;31m[[41;97mERROR[41;31m][0m [1mFailed to resolve GASTOWN_JWT_SECRET[0m


[gastown-worker] <-- POST /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/mayor/message 200 (6378ms)
[wrangler:info] POST /api/towns/235a017c-0f9c-4174-95f4-a360b4d0c97f/mayor/message 200 OK (6379ms)
[Town.do] alarm: fired for town=235a017c-0f9c-4174-95f4-a360b4d0c97f
ðŸªµ  Logs were written to "/Users/john/Library/Preferences/.wrangler/logs/wrangler-2026-02-21_02-40-02_902.log"
