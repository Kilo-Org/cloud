FROM node:22.14.0-slim

# Install pnpm
RUN corepack enable && corepack prepare pnpm@10.27.0 --activate

# Install wrangler globally for workers (pinned to match repo devDependencies)
RUN pnpm add -g wrangler@4.61.1

# Install bun (needed by cloud-agent and cloud-agent-next predev scripts)
# Pinned to a specific version for reproducibility
RUN apt-get update && apt-get install -y curl unzip && \
    curl -fsSL https://bun.sh/install | BUN_INSTALL=/usr/local bash -s "bun-v1.2.5" && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app
